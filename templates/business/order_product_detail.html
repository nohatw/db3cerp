{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load currency %}

{% block title %}<title>ç”¢å“è©³æƒ… - {{ order_product.variant.name }} - DB3C ERP</title>{% endblock %}

{% block css %}
<style>
    .detail-card {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .detail-header {
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    
    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
    }
    
    .status-NORMAL {
        background: #d4edda;
        color: #155724;
    }
    
    .status-FAILED {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-CANCELED {
        background: #e2e3e5;
        color: #383d41;
    }
    
    .status-RETURNED {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-DAMAGED {
        background: #f8d7da;
        color: #721c24;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: 70px 1fr;
        gap: 15px 20px;
        margin-bottom: 15px;
    }
    
    .info-label {
        font-weight: 600;
        color: #666;
    }
    
    .info-value {
        color: #333;
    }
    
    .stock-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    
    .stock-table th {
        background: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }
    
    .stock-table td {
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .stock-table tr:last-child td {
        border-bottom: none;
    }
    
    .stock-table tr:hover {
        background: #f8f9fa;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }
    
    .empty-state i {
        font-size: 48px;
        margin-bottom: 15px;
    }
    
    .badge-used {
        background: #dc3545;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
    }
    
    .badge-available {
        background: #28a745;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
    }
    
    .summary-box {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #dee2e6;
    }
    
    .summary-item:last-child {
        border-bottom: none;
        font-size: 1.2rem;
        font-weight: bold;
        padding-top: 15px;
        margin-top: 5px;
        border-top: 2px solid #dee2e6;
    }
    
    .product-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .qr-card {
        transition: all 0.3s ease;
    }
    
    .qr-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
    }
    
    .qr-card img {
        transition: transform 0.3s ease;
    }
    
    .qr-card img:hover {
        transform: scale(1.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-body">
    <div class="container-xl">
        <!-- é é¢æ¨™é¡Œ -->
        <div class="page-header d-print-none">
            <div class="row align-items-center">
                <div class="col">
                    <div class="page-pretitle">
                        <a href="{% url 'business:order_detail' pk=order_product.order.id %}">
                            è¨‚å–® #{{ order_product.order.id }}
                        </a>
                    </div>
                    <h2 class="page-title">
                        ç”¢å“è©³æƒ…ï¼š{{ order_product.variant.name|default:"å·²ä¸‹æ¶å•†å“" }}
                    </h2>
                </div>
                <div class="col-auto ms-auto d-print-none">
                    <a href="{% url 'business:order_detail' pk=order_product.order.id %}" class="btn btn-outline-secondary">
                        <i class="ti ti-arrow-left"></i> è¿”å›è¨‚å–®
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- å·¦å´ï¼šç”¢å“åŸºæœ¬è³‡è¨Š -->
            <div class="col-lg-8">
                <!-- ç”¢å“ç‹€æ…‹èˆ‡åŸºæœ¬è³‡è¨Š -->
                <div class="detail-card">
                    <div class="detail-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h3>ç”¢å“è³‡è¨Š</h3>
                            <span class="status-badge status-{{ order_product.status }}">
                                {{ order_product.get_status_display }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-label">ç”¢å“åç¨±</div>
                        <div class="info-value">
                            <strong>{{ order_product.variant.name|default:"å·²ä¸‹æ¶å•†å“" }}</strong>
                        </div>
                        
                        <div class="info-label">ç”¢å“ä»£ç¢¼</div>
                        <div class="info-value">
                            <code>{{ order_product.product_code }}</code>
                        </div>
                        
                        {% if order_product.variant %}
                        <div class="info-label">ç”¢å“é¡å‹</div>
                        <div class="info-value">
                            <span class="badge bg-info">
                                {{ order_product.variant.get_product_type_display }}
                            </span>
                        </div>
                        
                        {% if order_product.variant.days %}
                        <div class="info-label">æ–¹æ¡ˆå¤©æ•¸</div>
                        <div class="info-value">{{ order_product.variant.days }} å¤©</div>
                        {% endif %}
                        
                        {% if order_product.variant.data_amount %}
                        <div class="info-label">æµé‡è¦æ ¼</div>
                        <div class="info-value">{{ order_product.variant.data_amount }}</div>
                        {% endif %}
                        {% endif %}
                        
                        <div class="info-label">è¨‚è³¼æ•¸é‡</div>
                        <div class="info-value">
                            <strong>{{ order_product.quantity }}</strong> ä»¶
                        </div>
                        
                        <div class="info-label">è¨‚è³¼å–®åƒ¹</div>
                        <div class="info-value">${{ order_product.unit_price|currency }}</div>
                        
                        <div class="info-label">å°è¨ˆé‡‘é¡</div>
                        <div class="info-value">
                            <strong class="text-success">${{ order_product.amount|currency }}</strong>
                        </div>
                    </div>
                </div>

                <!-- åº«å­˜ä½¿ç”¨è¨˜éŒ„ -->
                <div class="detail-card">
                    <div class="detail-header">
                        <h3>
                            <i class="ti ti-box"></i> åº«å­˜ä½¿ç”¨è¨˜éŒ„
                        </h3>
                        <div class="text-muted small mt-2">
                            é¡¯ç¤ºæ­¤è¨‚å–®ç”¢å“æ‰£é™¤çš„åº«å­˜æ˜ç´°
                        </div>
                    </div>
                    
                    {% if used_stocks_details %}
                    <table class="stock-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">åºè™Ÿ</th>
                                <th style="width: 25%;">åº«å­˜åç¨±</th>
                                <th style="width: 20%;">åº«å­˜ä»£ç¢¼</th>
                                <th style="width: 15%; text-align: center;">æ‰£é™¤æ•¸é‡</th>
                                <th style="width: 15%; text-align: center;">æ‰£é™¤å‰åº«å­˜</th>
                                <th style="width: 15%; text-align: center;">ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detail in used_stocks_details %}
                            <tr>
                                <td class="text-center">{{ forloop.counter }}</td>
                                <td>
                                    {% if detail.stock %}
                                        {{ detail.stock.name }}
                                    {% else %}
                                        <span class="text-muted">
                                            <i class="ti ti-alert-circle"></i>
                                            å·²åˆªé™¤çš„åº«å­˜ (ID: {{ detail.stock_id }})
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if detail.stock and detail.stock.code %}
                                        <code>{{ detail.stock.code }}</code>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    <strong class="text-danger">
                                        {{ detail.deducted_quantity }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    {{ detail.stock_quantity_before|default:"-" }}
                                </td>
                                <td class="text-center">
                                    {% if detail.stock %}
                                        {% if detail.stock.is_used %}
                                            <span class="badge-used">å·²ä½¿ç”¨</span>
                                        {% else %}
                                            <span class="badge-available">å¯ç”¨</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    <!-- åº«å­˜çµ±è¨ˆ -->
                    <div class="summary-box">
                        <div class="summary-item">
                            <span>ç¸½æ‰£é™¤æ•¸é‡</span>
                            <span><strong>{{ order_product.quantity }}</strong> ä»¶</span>
                        </div>
                        <div class="summary-item">
                            <span>ä½¿ç”¨åº«å­˜è¨˜éŒ„</span>
                            <span><strong>{{ used_stocks_details|length }}</strong> ç­†</span>
                        </div>
                    </div>
                    
                    {% else %}
                    <div class="empty-state">
                        <i class="ti ti-box-off"></i>
                        <h4>æ²’æœ‰åº«å­˜ä½¿ç”¨è¨˜éŒ„</h4>
                        <p class="text-muted">
                            {% if order_product.order.status == 'HOLDING' %}
                                æ­¤è¨‚å–®ç‚ºé è¨‚ç‹€æ…‹ï¼Œå°šæœªæ‰£é™¤åº«å­˜
                            {% else %}
                                æ­¤ç”¢å“å¯èƒ½ç‚ºèˆŠè³‡æ–™æˆ–æ‰‹å‹•å»ºç«‹ï¼Œæœªè¨˜éŒ„åº«å­˜ä½¿ç”¨æ˜ç´°
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- å…Œæ›è©³ç´°è³‡è¨Š -->
                <div class="detail-card">
                    <div class="detail-header">
                        <h3>
                            <i class="ti ti-qrcode"></i> å…Œæ›è©³ç´°è³‡è¨Š
                        </h3>
                        {% if is_esimimg %}
                        <div class="text-muted small mt-2">
                            é¡¯ç¤ºæ­¤è¨‚å–®ç”¢å“çš„æ‰€æœ‰ QR Code åœ–ç‰‡å’Œä»£ç¢¼
                        </div>
                        {% elif order_product.variant.product_type == 'rechargeable' %}
                        <div class="text-muted small mt-2">
                            ç®¡ç†æ­¤è¨‚å–®ç”¢å“çš„æ‰€æœ‰å¯¦é«”å¡è™Ÿ
                        </div>
                        {% else %}
                        <div class="text-muted small mt-2">
                            æœªä¾†å¯é¡¯ç¤ºå€‹åˆ¥å¡è™Ÿã€åºè™Ÿã€äºŒç¶­ç¢¼ç­‰è³‡è¨Š
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if is_esimimg and esimimg_details %}
                    <!-- âœ… ESIMIMG é¡å‹ï¼šé¡¯ç¤º QR Code åˆ—è¡¨ -->
                    <div class="row g-3">
                        {% for item in esimimg_details %}
                        <div class="col-md-6 col-lg-4">
                            <div class="card border shadow-sm h-100">
                                <div class="card-body text-center p-2">
                                    <!-- é †åºç·¨è™Ÿ -->
                                    <div class="mb-2">
                                        <span class="badge bg-primary" style="font-size: 14px;">
                                            #{{ item.sequence }}
                                        </span>
                                    </div>
                                    
                                    <!-- QR Code åœ–ç‰‡ -->
                                    {% if item.qr_img_url %}
                                    <div class="mb-1">
                                        <img src="{{ item.qr_img_url }}" 
                                             alt="QR Code {{ item.code }}" 
                                             class="img-fluid rounded border"
                                             style="max-width: 100%; max-height: 200px; cursor: pointer;"
                                             onclick="showQRModal('{{ item.qr_img_url }}', '{{ item.code }}', '{{ item.product_name }} - {{ item.variant_name }}')">
                                    </div>
                                    {% else %}
                                    <div class="mb-3 p-4 bg-light rounded">
                                        <i class="ti ti-photo-off" style="font-size: 48px; color: #ccc;"></i>
                                        <p class="text-muted small mb-0 mt-2">åœ–ç‰‡ä¸å­˜åœ¨</p>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- SnCode -->
                                    <div class="mb-2">
                                        <strong>SnCode:</strong>
                                        <div>
                                            <code style="font-size: 13px;">{{ item.code }}</code>
                                        </div>
                                    </div>
                                    
                                    <!-- ç”¢å“åç¨± -->
                                    <div class="mb-2 small text-muted">
                                        {{ item.product_name }}
                                        {% if item.variant_name %}
                                        <br>{{ item.variant_name }}
                                        {% endif %}
                                    </div>
                                    
                                    <!-- å…Œæ›æ™‚é–“ -->
                                    {% if item.exchange_time %}
                                    <div class="text-success small">
                                        <i class="ti ti-check-circle"></i>
                                        å·²å…Œæ›ï¼š{{ item.exchange_time|date:"Y-m-d H:i" }}
                                    </div>
                                    {% else %}
                                    <div class="text-muted small">
                                        <i class="ti ti-clock"></i>
                                        å°šæœªå…Œæ›
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- çµ±è¨ˆè³‡è¨Š -->
                    <div class="alert alert-info mt-4 mb-0">
                        <div class="d-flex align-items-center">
                            <i class="ti ti-info-circle me-2" style="font-size: 24px;"></i>
                            <div>
                                <strong>å…± {{ total_qr_count }} å¼µ QR Code</strong>
                                <br>
                                <small>
                                    å·²å…Œæ›ï¼š{{ used_qr_count }} å¼µï¼Œ
                                    æœªå…Œæ›ï¼š{{ unused_qr_count }} å¼µ
                                </small>
                            </div>
                        </div>
                    </div>

                    {% elif order_product.variant.product_type == 'rechargeable' %}
                    <!-- RECHARGEABLE é¡å‹ï¼šé¡¯ç¤ºå¡è™Ÿç®¡ç†å…¥å£ -->
                    <div class="text-center py-5">
                        <i class="ti ti-credit-card" style="font-size: 64px; color: #0d6efd;"></i>
                        <h4 class="mt-3">å……å€¼å¡å¡è™Ÿç®¡ç†</h4>
                        <p class="text-muted mb-4">
                            æ­¤è¨‚å–®åŒ…å« <strong>{{ order_product.quantity }}</strong> å¼µå……å€¼å¡<br>
                            è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œå¡è™Ÿç®¡ç†
                        </p>
                        
                        <a href="{% url 'business:rechargeable_codes_manage' order_id=order_product.order.id product_id=order_product.id %}" 
                           class="btn btn-primary btn-lg">
                            <i class="ti ti-edit"></i> ç®¡ç†å¡è™Ÿ
                        </a>
                        
                        <div class="alert alert-info mt-4 mx-auto" style="max-width: 600px;">
                            <i class="ti ti-info-circle"></i>
                            <strong>åŠŸèƒ½èªªæ˜ï¼š</strong>
                            <ul class="text-start mb-0 mt-2">
                                <li>æ¯å¼µå……å€¼å¡éƒ½æœ‰ä¸€å€‹å”¯ä¸€çš„å¡è™Ÿï¼ˆsn_codeï¼‰</li>
                                <li>å¡«å¯«å¡è™Ÿå¾Œï¼Œå¯é€é API å•Ÿç”¨æ–¹æ¡ˆ</li>
                                <li>å„²å­˜å¡è™Ÿä¸æœƒç«‹å³æ¨é€åˆ° API</li>
                            </ul>
                        </div>
                    </div>
                    
                    {% else %}
                    <!-- å…¶ä»–é¡å‹æˆ–æ²’æœ‰è³‡æ–™ -->
                    <div class="empty-state">
                        <i class="ti ti-tools"></i>
                        <h4>åŠŸèƒ½é–‹ç™¼ä¸­</h4>
                        <p class="text-muted">
                            æ­¤åŠŸèƒ½å°‡é¡¯ç¤ºï¼š<br>
                            â€¢ å€‹åˆ¥å¡è™Ÿ/åºè™Ÿåˆ—è¡¨<br>
                            â€¢ å…Œæ›ç¢¼è³‡è¨Š<br>
                            â€¢ QR Code åœ–ç‰‡<br>
                            â€¢ å…Œæ›ç‹€æ…‹è¿½è¹¤
                        </p>
                    </div>
                    {% endif %}
                </div>
                
            </div>

            <!-- å³å´ï¼šè¨‚å–®è³‡è¨Š -->
            <div class="col-lg-4">
                <!-- æ‰€å±¬è¨‚å–® -->
                <div class="detail-card">
                    <div class="detail-header">
                        <h3>æ‰€å±¬è¨‚å–®</h3>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-label">è¨‚å–®ç·¨è™Ÿ</div>
                        <div class="info-value">
                            <a href="{% url 'business:order_detail' pk=order_product.order.id %}">
                                #{{ order_product.order.id }}
                            </a>
                        </div>
                        
                        <div class="info-label">è¨‚å–®ç‹€æ…‹</div>
                        <div class="info-value">
                            <span class="badge bg-{{ order_product.order.status|lower }}">
                                {{ order_product.order.get_status_display }}
                            </span>
                        </div>
                        
                        <div class="info-label">è¨‚è³¼å¸³è™Ÿ</div>
                        <div class="info-value">
                            {{ order_product.order.account.fullname|default:order_product.order.account.username }}
                        </div>
                        
                        <div class="info-label">æ”¯ä»˜æ–¹å¼</div>
                        <div class="info-value">
                            {{ order_product.order.get_payment_type_display }}
                        </div>
                        
                        <div class="info-label">è¨‚å–®ä¾†æº</div>
                        <div class="info-value">
                            {{ order_product.order.get_order_source_display }}
                        </div>
                        
                        <div class="info-label">å»ºç«‹æ™‚é–“</div>
                        <div class="info-value">
                            {{ order_product.order.created_at|date:"Y-m-d H:i" }}
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 mt-3">
                        <a href="{% url 'business:order_detail' pk=order_product.order.id %}" 
                           class="btn btn-primary">
                            <i class="ti ti-eye"></i> æŸ¥çœ‹å®Œæ•´è¨‚å–®
                        </a>
                    </div>
                </div>

                <!-- ç”¢å“ç‹€æ…‹èªªæ˜ -->
                <div class="detail-card">
                    <div class="detail-header">
                        <h3>ç‹€æ…‹èªªæ˜</h3>
                    </div>
                    
                    <div class="list-group list-group-flush">
                        <div class="list-group-item">
                            <div class="d-flex align-items-center">
                                <span class="status-badge status-NORMAL me-2">æ­£å¸¸</span>
                                <small class="text-muted">å…Œæ›æˆåŠŸ</small>
                            </div>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex align-items-center">
                                <span class="status-badge status-FAILED me-2">å¤±æ•—</span>
                                <small class="text-muted">å…Œæ›å¤±æ•—</small>
                            </div>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex align-items-center">
                                <span class="status-badge status-CANCELED me-2">å·²å–æ¶ˆ</span>
                                <small class="text-muted">è¨‚å–®å·²å–æ¶ˆ</small>
                            </div>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex align-items-center">
                                <span class="status-badge status-RETURNED me-2">å·²é€€è²¨</span>
                                <small class="text-muted">ç”¢å“å·²é€€å›</small>
                            </div>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex align-items-center">
                                <span class="status-badge status-DAMAGED me-2">æå£</span>
                                <small class="text-muted">ç”¢å“æå£</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œè¨˜éŒ„ï¼ˆæœªä¾†æ“´å……ï¼‰ -->
                <div class="detail-card">
                    <div class="detail-header">
                        <h3>æ“ä½œè¨˜éŒ„</h3>
                    </div>
                    
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-badge bg-success">
                                <i class="ti ti-plus"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="fw-bold">ç”¢å“åŠ å…¥è¨‚å–®</div>
                                <div class="text-muted small">
                                    {{ order_product.created_at|date:"Y-m-d H:i:s" }}
                                </div>
                            </div>
                        </div>
                        
                        {% if order_product.status != 'NORMAL' %}
                        <div class="timeline-item">
                            <div class="timeline-badge bg-warning">
                                <i class="ti ti-alert-circle"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="fw-bold">ç‹€æ…‹è®Šæ›´</div>
                                <div class="text-muted small">
                                    {{ order_product.updated_at|date:"Y-m-d H:i:s" }}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- QR Code æ”¾å¤§æ¨¡æ…‹æ¡† -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="qrModalLabel">QR Code è©³æƒ…</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="qrModalImage" src="" alt="QR Code" class="img-fluid mb-3" style="max-width: 100%;">
                <div>
                    <strong>SnCode:</strong>
                    <div>
                        <code id="qrModalCode" style="font-size: 18px;"></code>
                    </div>
                </div>
                <div class="mt-2 text-muted small" id="qrModalProduct"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                <a id="qrModalDownload" href="" download class="btn btn-primary">
                    <i class="ti ti-download"></i> ä¸‹è¼‰åœ–ç‰‡
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scriptcontent %}
<script>
    console.log('ğŸ“¦ è¨‚å–®ç”¢å“è©³æƒ…é é¢è¼‰å…¥');
    console.log('ç”¢å“ ID:', '{{ order_product.id }}');
    console.log('ç”¢å“ç‹€æ…‹:', '{{ order_product.status }}');
    console.log('è¨‚å–® ID:', '{{ order_product.order.id }}');
    console.log('æ˜¯å¦ç‚º ESIMIMG:', '{{ is_esimimg }}');
    
    // QR Code æ”¾å¤§é¡¯ç¤ºåŠŸèƒ½
    function showQRModal(imageUrl, code, productInfo) {
        // è¨­å®šæ¨¡æ…‹æ¡†å…§å®¹
        document.getElementById('qrModalImage').src = imageUrl;
        document.getElementById('qrModalCode').textContent = code;
        document.getElementById('qrModalProduct').textContent = productInfo;
        document.getElementById('qrModalDownload').href = imageUrl;
        document.getElementById('qrModalDownload').download = `QR_${code}.png`;
        
        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        const modal = new bootstrap.Modal(document.getElementById('qrModal'));
        modal.show();
    }
</script>
{% endblock %}